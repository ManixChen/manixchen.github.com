import{al as q,am as Ce,an as ie,ao as Le,b as we,$ as Z,a0 as he,a as de,j as le,ap as ge,aq as Se,ar as ze,l as be,k as ke,as as Te,r as S,at as Ne,s as Oe,c as E,w as fe,ak as Ie,o as Ee,m as L,q as me,A as p,t as A,x as C,y as h,d as t,H as ve,z as $e,D as R,E as F,aa as Ae,n as B,I as oe,B as Re,F as Be,au as Me,av as Ve,ac as De,aw as Fe,ax as Pe,J as Xe,v as Ye,C as He,G as re,T as We,ay as je,_ as _e,az as K,aA as G,aB as Ke,P as xe,aC as qe,a2 as Ge,aD as Ue,g as Ze,K as Je,aE as Qe}from"./index-CaZaQ9on.js";import{u as et}from"./index-Bn3mk5cZ.js";import{g as tt}from"./scroll-inuxvSxR.js";const at=(e,i)=>{if(!q||!e||!i)return!1;const s=e.getBoundingClientRect();let c;return i instanceof Element?c=i.getBoundingClientRect():c={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},s.top<c.bottom&&s.bottom>c.top&&s.right>c.left&&s.left<c.right};var nt=/\s/;function st(e){for(var i=e.length;i--&&nt.test(e.charAt(i)););return i}var rt=/^\s+/;function it(e){return e&&e.slice(0,st(e)+1).replace(rt,"")}var pe=NaN,ot=/^[-+]0x[0-9a-f]+$/i,lt=/^0b[01]+$/i,ut=/^0o[0-7]+$/i,ct=parseInt;function ye(e){if(typeof e=="number")return e;if(Ce(e))return pe;if(ie(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ie(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=it(e);var s=lt.test(e);return s||ut.test(e)?ct(e.slice(2),s?2:8):ot.test(e)?pe:+e}var ue=function(){return Le.Date.now()},dt="Expected a function",ft=Math.max,mt=Math.min;function vt(e,i,s){var c,l,v,O,r,I,y=0,_=!1,x=!1,w=!0;if(typeof e!="function")throw new TypeError(dt);i=ye(i)||0,ie(s)&&(_=!!s.leading,x="maxWait"in s,v=x?ft(ye(s.maxWait)||0,i):v,w="trailing"in s?!!s.trailing:w);function f(u){var b=c,z=l;return c=l=void 0,y=u,O=e.apply(z,b),O}function M(u){return y=u,r=setTimeout(D,i),_?f(u):O}function d(u){var b=u-I,z=u-y,W=i-b;return x?mt(W,v-z):W}function V(u){var b=u-I,z=u-y;return I===void 0||b>=i||b<0||x&&z>=v}function D(){var u=ue();if(V(u))return P(u);r=setTimeout(D,d(u))}function P(u){return r=void 0,w&&c?f(u):(c=l=void 0,O)}function H(){r!==void 0&&clearTimeout(r),y=0,c=I=l=r=void 0}function X(){return r===void 0?O:P(ue())}function Y(){var u=ue(),b=V(u);if(c=arguments,l=this,I=u,b){if(r===void 0)return M(I);if(x)return clearTimeout(r),r=setTimeout(D,i),f(I)}return r===void 0&&(r=setTimeout(D,i)),O}return Y.cancel=H,Y.flush=X,Y}var gt="Expected a function";function ce(e,i,s){var c=!0,l=!0;if(typeof e!="function")throw new TypeError(gt);return ie(s)&&(c="leading"in s?!!s.leading:c,l="trailing"in s?!!s.trailing:l),vt(e,i,{leading:c,maxWait:i,trailing:l})}const pt=we({urlList:{type:Z(Array),default:()=>he([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:Z(String)}}),yt={close:()=>!0,switch:e=>de(e),rotate:e=>de(e)},wt=["src","crossorigin"],ht=le({name:"ElImageViewer"}),bt=le({...ht,props:pt,emits:yt,setup(e,{expose:i,emit:s}){var c;const l=e,v={CONTAIN:{name:"contain",icon:ge(Se)},ORIGINAL:{name:"original",icon:ge(ze)}},{t:O}=be(),r=ke("image-viewer"),{nextZIndex:I}=Te(),y=S(),_=S([]),x=Ne(),w=S(!0),f=S(l.initialIndex),M=Oe(v.CONTAIN),d=S({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),V=S((c=l.zIndex)!=null?c:I()),D=E(()=>{const{urlList:n}=l;return n.length<=1}),P=E(()=>f.value===0),H=E(()=>f.value===l.urlList.length-1),X=E(()=>l.urlList[f.value]),Y=E(()=>[r.e("btn"),r.e("prev"),r.is("disabled",!l.infinite&&P.value)]),u=E(()=>[r.e("btn"),r.e("next"),r.is("disabled",!l.infinite&&H.value)]),b=E(()=>{const{scale:n,deg:o,offsetX:m,offsetY:T,enableTransition:$}=d.value;let k=m/n,N=T/n;switch(o%360){case 90:case-270:[k,N]=[N,-k];break;case 180:case-180:[k,N]=[-k,-N];break;case 270:case-90:[k,N]=[-N,k];break}const j={transform:`scale(${n}) rotate(${o}deg) translate(${k}px, ${N}px)`,transition:$?"transform .3s":""};return M.value.name===v.CONTAIN.name&&(j.maxWidth=j.maxHeight="100%"),j});function z(){J(),s("close")}function W(){const n=ce(m=>{switch(m.code){case K.esc:l.closeOnPressEscape&&z();break;case K.space:ne();break;case K.left:se();break;case K.up:g("zoomIn");break;case K.right:a();break;case K.down:g("zoomOut");break}}),o=ce(m=>{const T=m.deltaY||m.deltaX;g(T<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});x.run(()=>{G(document,"keydown",n),G(document,"wheel",o)})}function J(){x.stop()}function Q(){w.value=!1}function ee(n){w.value=!1,n.target.alt=O("el.image.error")}function te(n){if(w.value||n.button!==0||!y.value)return;d.value.enableTransition=!1;const{offsetX:o,offsetY:m}=d.value,T=n.pageX,$=n.pageY,k=ce(j=>{d.value={...d.value,offsetX:o+j.pageX-T,offsetY:m+j.pageY-$}}),N=G(document,"mousemove",k);G(document,"mouseup",()=>{N()}),n.preventDefault()}function ae(){d.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ne(){if(w.value)return;const n=Ke(v),o=Object.values(v),m=M.value.name,$=(o.findIndex(k=>k.name===m)+1)%n.length;M.value=v[n[$]],ae()}function U(n){const o=l.urlList.length;f.value=(n+o)%o}function se(){P.value&&!l.infinite||U(f.value-1)}function a(){H.value&&!l.infinite||U(f.value+1)}function g(n,o={}){if(w.value)return;const{minScale:m,maxScale:T}=l,{zoomRate:$,rotateDeg:k,enableTransition:N}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...o};switch(n){case"zoomOut":d.value.scale>m&&(d.value.scale=Number.parseFloat((d.value.scale/$).toFixed(3)));break;case"zoomIn":d.value.scale<T&&(d.value.scale=Number.parseFloat((d.value.scale*$).toFixed(3)));break;case"clockwise":d.value.deg+=k,s("rotate",d.value.deg);break;case"anticlockwise":d.value.deg-=k,s("rotate",d.value.deg);break}d.value.enableTransition=N}return fe(X,()=>{Ie(()=>{const n=_.value[0];n!=null&&n.complete||(w.value=!0)})}),fe(f,n=>{ae(),s("switch",n)}),Ee(()=>{var n,o;W(),(o=(n=y.value)==null?void 0:n.focus)==null||o.call(n)}),i({setActiveItem:U}),(n,o)=>(L(),me(je,{to:"body",disabled:!n.teleported},[p(We,{name:"viewer-fade",appear:""},{default:A(()=>[C("div",{ref_key:"wrapper",ref:y,tabindex:-1,class:h(t(r).e("wrapper")),style:ve({zIndex:V.value})},[C("div",{class:h(t(r).e("mask")),onClick:o[0]||(o[0]=$e(m=>n.hideOnClickModal&&z(),["self"]))},null,2),R(" CLOSE "),C("span",{class:h([t(r).e("btn"),t(r).e("close")]),onClick:z},[p(t(F),null,{default:A(()=>[p(t(Ae))]),_:1})],2),R(" ARROW "),t(D)?R("v-if",!0):(L(),B(oe,{key:0},[C("span",{class:h(t(Y)),onClick:se},[p(t(F),null,{default:A(()=>[p(t(Re))]),_:1})],2),C("span",{class:h(t(u)),onClick:a},[p(t(F),null,{default:A(()=>[p(t(Be))]),_:1})],2)],64)),R(" ACTIONS "),C("div",{class:h([t(r).e("btn"),t(r).e("actions")])},[C("div",{class:h(t(r).e("actions__inner"))},[p(t(F),{onClick:o[1]||(o[1]=m=>g("zoomOut"))},{default:A(()=>[p(t(Me))]),_:1}),p(t(F),{onClick:o[2]||(o[2]=m=>g("zoomIn"))},{default:A(()=>[p(t(Ve))]),_:1}),C("i",{class:h(t(r).e("actions__divider"))},null,2),p(t(F),{onClick:ne},{default:A(()=>[(L(),me(De(t(M).icon)))]),_:1}),C("i",{class:h(t(r).e("actions__divider"))},null,2),p(t(F),{onClick:o[3]||(o[3]=m=>g("anticlockwise"))},{default:A(()=>[p(t(Fe))]),_:1}),p(t(F),{onClick:o[4]||(o[4]=m=>g("clockwise"))},{default:A(()=>[p(t(Pe))]),_:1})],2)],2),R(" CANVAS "),C("div",{class:h(t(r).e("canvas"))},[(L(!0),B(oe,null,Xe(n.urlList,(m,T)=>Ye((L(),B("img",{ref_for:!0,ref:$=>_.value[T]=$,key:m,src:m,style:ve(t(b)),class:h(t(r).e("img")),crossorigin:n.crossorigin,onLoad:Q,onError:ee,onMousedown:te},null,46,wt)),[[He,T===f.value]])),128))],2),re(n.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var kt=_e(bt,[["__file","image-viewer.vue"]]);const It=xe(kt),Et=we({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:Z([String,Object])},previewSrcList:{type:Z(Array),default:()=>he([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:Z(String)}}),_t={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>de(e),close:()=>!0,show:()=>!0},xt=["src","loading","crossorigin"],Ct={key:0},Lt=le({name:"ElImage",inheritAttrs:!1}),St=le({...Lt,props:Et,emits:_t,setup(e,{emit:i}){const s=e;let c="";const{t:l}=be(),v=ke("image"),O=qe(),r=et(),I=S(),y=S(!1),_=S(!0),x=S(!1),w=S(),f=S(),M=q&&"loading"in HTMLImageElement.prototype;let d,V;const D=E(()=>[v.e("inner"),X.value&&v.e("preview"),_.value&&v.is("loading")]),P=E(()=>O.style),H=E(()=>{const{fit:a}=s;return q&&a?{objectFit:a}:{}}),X=E(()=>{const{previewSrcList:a}=s;return Array.isArray(a)&&a.length>0}),Y=E(()=>{const{previewSrcList:a,initialIndex:g}=s;let n=g;return g>a.length-1&&(n=0),n}),u=E(()=>s.loading==="eager"?!1:!M&&s.loading==="lazy"||s.lazy),b=()=>{q&&(_.value=!0,y.value=!1,I.value=s.src)};function z(a){_.value=!1,y.value=!1,i("load",a)}function W(a){_.value=!1,y.value=!0,i("error",a)}function J(){at(w.value,f.value)&&(b(),te())}const Q=Qe(J,200,!0);async function ee(){var a;if(!q)return;await Ie();const{scrollContainer:g}=s;Ue(g)?f.value=g:Ze(g)&&g!==""?f.value=(a=document.querySelector(g))!=null?a:void 0:w.value&&(f.value=tt(w.value)),f.value&&(d=G(f,"scroll",Q),setTimeout(()=>J(),100))}function te(){!q||!f.value||!Q||(d==null||d(),f.value=void 0)}function ae(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}function ne(){X.value&&(V=G("wheel",ae,{passive:!1}),c=document.body.style.overflow,document.body.style.overflow="hidden",x.value=!0,i("show"))}function U(){V==null||V(),document.body.style.overflow=c,x.value=!1,i("close")}function se(a){i("switch",a)}return fe(()=>s.src,()=>{u.value?(_.value=!0,y.value=!1,te(),ee()):b()}),Ee(()=>{u.value?ee():b()}),(a,g)=>(L(),B("div",{ref_key:"container",ref:w,class:h([t(v).b(),a.$attrs.class]),style:ve(t(P))},[y.value?re(a.$slots,"error",{key:0},()=>[C("div",{class:h(t(v).e("error"))},Je(t(l)("el.image.error")),3)]):(L(),B(oe,{key:1},[I.value!==void 0?(L(),B("img",Ge({key:0},t(r),{src:I.value,loading:a.loading,style:t(H),class:t(D),crossorigin:a.crossorigin,onClick:ne,onLoad:z,onError:W}),null,16,xt)):R("v-if",!0),_.value?(L(),B("div",{key:1,class:h(t(v).e("wrapper"))},[re(a.$slots,"placeholder",{},()=>[C("div",{class:h(t(v).e("placeholder"))},null,2)])],2)):R("v-if",!0)],64)),t(X)?(L(),B(oe,{key:2},[x.value?(L(),me(t(It),{key:0,"z-index":a.zIndex,"initial-index":t(Y),infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"url-list":a.previewSrcList,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:U,onSwitch:se},{default:A(()=>[a.$slots.viewer?(L(),B("div",Ct,[re(a.$slots,"viewer")])):R("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):R("v-if",!0)],64)):R("v-if",!0)],6))}});var zt=_e(St,[["__file","image.vue"]]);const $t=xe(zt);export{$t as E,ce as t};
